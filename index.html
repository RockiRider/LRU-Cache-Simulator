<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />

  <title>Cache Simulation LRU</title>
  <meta name="description" content="Cache Simulation LRU" />
  <meta name="Tsotne Gvadzabia" />
</head>

<body>
  <h1>Title</h1>
  <section class="example"></section>
  <section class="inputer">
    <label for="define">Definition:</label>
    <input type="text" id="define" name="define" placeholder="8 4 2 2" required /><br /><br />
    <textarea id="input" rows="4" cols="50"></textarea>
    <br />
    <button id="startSim">Simulate</button>
  </section>

  <section class="asw">
    <h4 id="display">Answer Here</h4>
  </section>

  <script>

     

    getDef = () =>{
      return  document.getElementById("define").value
    }
    getInput = () =>{
      return document.getElementById("input").value
    }

    startSimulation = () => {
      var output= "";
      var defined = getDef();
      var question = getInput();
      
      // ToDo defined in correct format with spaces

      var arrDefinition = defined.split(" ");
      var arrQuestions = question.match(/[^\r\n]+/g);
      
      // To Do check if array is correct length of 4.


      // Declerations Below
      const w = arrDefinition[0];
      const c = arrDefinition[1];
      const b = arrDefinition[2];
      const k = arrDefinition[3];


      let indexSizeCalc = c/b;
      let offsetSizeCalc = b/k;


      var indexSize = Math.log2(indexSizeCalc);  // Maybe take away this log first
      var offsetSize = Math.log2(offsetSizeCalc); // Take away this log last
      const tagSize = w - indexSize - offsetSize; 


      if(offsetSizeCalc = 2){
        offsetSize = 2;
      }


      //Console Logs Below
      console.log(indexSize + " index");
      console.log(offsetSize + " off");
      console.log(tagSize + " tag");
      console.log(arrQuestions)


      var qLength = arrQuestions.length;

      var arrAddress = [];

      for(var i = 0; i<qLength;i++){
        let toNum = parseInt(arrQuestions[i]);
        let binaryVal = toNum.toString(2);

        //Ensure same number of binary bits
        if(binaryVal.length < w){
            let difference = w - binaryVal.length;
            for(var z = 0; z<difference;z++){
              binaryVal = '0'+binaryVal;
            }
        }
        arrAddress.push(binaryVal);
      }
      console.log(arrAddress);

      //Tag Generation

      var arrOnlyTags = [];
      var addressLength = arrAddress.length;
      var removeChar = parseInt(indexSize + offsetSize);

      for(var y = 0; y < addressLength; y++){

        var temp = arrAddress[y].slice(0, -removeChar);
        arrOnlyTags.push(temp);

      }
      console.log(arrOnlyTags);


      // Grouping
      arrCurrent = [];
     
      for(var g = 0; g < addressLength; g++){
        if(!arrCurrent.includes(arrOnlyTags[g])){
          if(arrCurrent.length<b){
            arrCurrent.push(arrOnlyTags[g]);
            output = output + "M";
          }else if(arrCurrent.length = b){
            arrCurrent.shift();
            arrCurrent.push(arrOnlyTags[g]);
            output = output + "M";
          }else{
            alert("ERROR");
          }
        }else{
          output = output + "C";
        }
          
      }
      document.getElementById("display").innerHTML = output;
    };

    document.getElementById("startSim").addEventListener("click", startSimulation);
  </script>
</body>

</html>